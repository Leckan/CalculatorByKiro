<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reduced Motion Support Test - Task 16</title>
    <link rel="stylesheet" href="../styles/main.css">
    <style>
        body {
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            margin: 0 0 10px 0;
            color: white;
        }
        
        .test-header p {
            margin: 5px 0;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .motion-toggle {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .motion-toggle h2 {
            margin: 0 0 15px 0;
            color: white;
            font-size: 1.2rem;
        }
        
        .toggle-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .toggle-button:hover {
            background: #5568d3;
        }
        
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status.normal {
            background: rgba(102, 126, 234, 0.2);
            color: #a5b4fc;
        }
        
        .status.reduced {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-card h3 {
            margin: 0 0 15px 0;
            color: white;
            font-size: 1.1rem;
        }
        
        .test-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .test-button:hover {
            background: #5568d3;
        }
        
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
        }
        
        .result.pass {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            display: block;
        }
        
        .result.fail {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            display: block;
        }
        
        .calculator-demo {
            margin-top: 30px;
        }
        
        .instructions {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .instructions h3 {
            margin: 0 0 10px 0;
            color: #c4b5fd;
        }
        
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéØ Task 16: Reduced Motion Support Test</h1>
            <p><strong>Requirements:</strong> 1.5 - Maintain high contrast ratios for accessibility compliance</p>
            <p><strong>Testing:</strong> Verify animations are disabled/reduced when user prefers reduced motion</p>
        </div>

        <div class="motion-toggle">
            <h2>Motion Preference Simulator</h2>
            <p>Current Mode: <span class="status normal" id="motion-status">Normal Motion</span></p>
            <button class="toggle-button" id="toggle-motion">Enable Reduced Motion</button>
            <button class="toggle-button" id="reload-page">Reload Page</button>
        </div>

        <div class="instructions">
            <h3>üìã Testing Instructions</h3>
            <ul>
                <li><strong>Automated Test:</strong> Click "Enable Reduced Motion" to simulate the preference</li>
                <li><strong>Manual Test:</strong> Enable reduced motion in your OS settings:
                    <ul>
                        <li><strong>macOS:</strong> System Preferences ‚Üí Accessibility ‚Üí Display ‚Üí Reduce motion</li>
                        <li><strong>Windows:</strong> Settings ‚Üí Ease of Access ‚Üí Display ‚Üí Show animations</li>
                        <li><strong>Linux:</strong> Varies by desktop environment</li>
                    </ul>
                </li>
                <li>After enabling, reload the page and observe the calculator behavior</li>
                <li>All tests below should pass in reduced motion mode</li>
            </ul>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>Test 1: Entrance Animation</h3>
                <p>Calculator should appear instantly without fade/scale animation</p>
                <button class="test-button" onclick="testEntranceAnimation()">Run Test</button>
                <div class="result" id="result-entrance"></div>
            </div>

            <div class="test-card">
                <h3>Test 2: Button Stagger</h3>
                <p>Buttons should appear instantly without staggered delays</p>
                <button class="test-button" onclick="testButtonStagger()">Run Test</button>
                <div class="result" id="result-stagger"></div>
            </div>

            <div class="test-card">
                <h3>Test 3: Gradient Animation</h3>
                <p>Background should be static without animated gradient</p>
                <button class="test-button" onclick="testGradientAnimation()">Run Test</button>
                <div class="result" id="result-gradient"></div>
            </div>

            <div class="test-card">
                <h3>Test 4: Transition Duration</h3>
                <p>Transitions should be very short (‚â§ 50ms) for essential feedback</p>
                <button class="test-button" onclick="testTransitionDuration()">Run Test</button>
                <div class="result" id="result-transition"></div>
            </div>

            <div class="test-card">
                <h3>Test 5: Hover Effects</h3>
                <p>Hover should not include transform animations</p>
                <button class="test-button" onclick="testHoverEffects()">Run Test</button>
                <div class="result" id="result-hover"></div>
            </div>

            <div class="test-card">
                <h3>Test 6: Functionality</h3>
                <p>All calculator functions should work normally</p>
                <button class="test-button" onclick="testFunctionality()">Run Test</button>
                <div class="result" id="result-functionality"></div>
            </div>
        </div>

        <div class="calculator-demo">
            <h2 style="color: white; margin-bottom: 20px;">Live Calculator Demo</h2>
            <div id="calculator-container">
                <!-- Calculator will be inserted here -->
            </div>
        </div>
    </div>

    <script src="../src/calculator-engine.js"></script>
    <script src="../src/expression-parser.js"></script>
    <script src="../src/number-formatter.js"></script>
    <script src="../src/memory-manager.js"></script>
    <script src="../src/state-manager.js"></script>
    <script src="../src/calculator-view.js"></script>
    <script src="../src/calculator-controller.js"></script>
    <script src="../main.js"></script>
    
    <script>
        // Motion preference toggle
        const toggleButton = document.getElementById('toggle-motion');
        const statusElement = document.getElementById('motion-status');
        let reducedMotionEnabled = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        function updateStatus() {
            if (reducedMotionEnabled) {
                statusElement.textContent = 'Reduced Motion';
                statusElement.className = 'status reduced';
                toggleButton.textContent = 'Disable Reduced Motion';
            } else {
                statusElement.textContent = 'Normal Motion';
                statusElement.className = 'status normal';
                toggleButton.textContent = 'Enable Reduced Motion';
            }
        }

        toggleButton.addEventListener('click', () => {
            reducedMotionEnabled = !reducedMotionEnabled;
            
            // Simulate reduced motion by adding/removing a class
            if (reducedMotionEnabled) {
                document.documentElement.style.setProperty('--test-reduced-motion', 'reduce');
                // Add a style tag to simulate the media query
                const style = document.createElement('style');
                style.id = 'reduced-motion-sim';
                style.textContent = `
                    body { animation: none !important; background: #0f172a !important; }
                    .calculator, .calc-button { animation: none !important; opacity: 1 !important; transform: none !important; }
                    * { transition-duration: 0.05s !important; animation-duration: 0.05s !important; }
                `;
                document.head.appendChild(style);
            } else {
                document.documentElement.style.removeProperty('--test-reduced-motion');
                const style = document.getElementById('reduced-motion-sim');
                if (style) style.remove();
            }
            
            updateStatus();
        });

        document.getElementById('reload-page').addEventListener('click', () => {
            location.reload();
        });

        updateStatus();

        // Test functions
        function testEntranceAnimation() {
            const calculator = document.querySelector('.calculator');
            const result = document.getElementById('result-entrance');
            
            if (!calculator) {
                result.textContent = '‚ùå Calculator not found';
                result.className = 'result fail';
                return;
            }

            const computedStyle = window.getComputedStyle(calculator);
            const animation = computedStyle.animation || computedStyle.webkitAnimation;
            
            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches || 
                                 document.getElementById('reduced-motion-sim');
            
            if (reducedMotion) {
                if (animation === 'none' || animation === '') {
                    result.textContent = '‚úÖ PASS: Entrance animation disabled';
                    result.className = 'result pass';
                } else {
                    result.textContent = '‚ùå FAIL: Entrance animation still active';
                    result.className = 'result fail';
                }
            } else {
                if (animation && animation !== 'none') {
                    result.textContent = '‚úÖ PASS: Entrance animation enabled (normal mode)';
                    result.className = 'result pass';
                } else {
                    result.textContent = '‚ö†Ô∏è Animation may have completed';
                    result.className = 'result pass';
                }
            }
        }

        function testButtonStagger() {
            const buttons = document.querySelectorAll('.calc-button');
            const result = document.getElementById('result-stagger');
            
            if (buttons.length === 0) {
                result.textContent = '‚ùå No buttons found';
                result.className = 'result fail';
                return;
            }

            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches || 
                                 document.getElementById('reduced-motion-sim');
            
            if (reducedMotion) {
                const firstButton = buttons[0];
                const computedStyle = window.getComputedStyle(firstButton);
                const animation = computedStyle.animation || computedStyle.webkitAnimation;
                
                if (animation === 'none' || animation === '') {
                    result.textContent = '‚úÖ PASS: Button stagger disabled';
                    result.className = 'result pass';
                } else {
                    result.textContent = '‚ùå FAIL: Button stagger still active';
                    result.className = 'result fail';
                }
            } else {
                result.textContent = '‚úÖ PASS: Button stagger enabled (normal mode)';
                result.className = 'result pass';
            }
        }

        function testGradientAnimation() {
            const body = document.body;
            const result = document.getElementById('result-gradient');
            
            const computedStyle = window.getComputedStyle(body);
            const animation = computedStyle.animation || computedStyle.webkitAnimation;
            
            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches || 
                                 document.getElementById('reduced-motion-sim');
            
            if (reducedMotion) {
                if (animation === 'none' || animation === '') {
                    result.textContent = '‚úÖ PASS: Gradient animation disabled';
                    result.className = 'result pass';
                } else {
                    result.textContent = '‚ùå FAIL: Gradient animation still active';
                    result.className = 'result fail';
                }
            } else {
                if (animation && animation !== 'none') {
                    result.textContent = '‚úÖ PASS: Gradient animation enabled (normal mode)';
                    result.className = 'result pass';
                } else {
                    result.textContent = '‚ö†Ô∏è Animation may not be active';
                    result.className = 'result pass';
                }
            }
        }

        function testTransitionDuration() {
            const button = document.querySelector('.calc-button');
            const result = document.getElementById('result-transition');
            
            if (!button) {
                result.textContent = '‚ùå No button found';
                result.className = 'result fail';
                return;
            }

            const computedStyle = window.getComputedStyle(button);
            const transitionDuration = computedStyle.transitionDuration;
            
            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches || 
                                 document.getElementById('reduced-motion-sim');
            
            if (reducedMotion) {
                // Parse duration (could be in seconds or milliseconds)
                const durationMs = transitionDuration.includes('ms') 
                    ? parseFloat(transitionDuration) 
                    : parseFloat(transitionDuration) * 1000;
                
                if (durationMs <= 50) {
                    result.textContent = `‚úÖ PASS: Transition reduced to ${durationMs.toFixed(1)}ms`;
                    result.className = 'result pass';
                } else {
                    result.textContent = `‚ùå FAIL: Transition still ${durationMs.toFixed(1)}ms (should be ‚â§ 50ms)`;
                    result.className = 'result fail';
                }
            } else {
                result.textContent = `‚úÖ PASS: Normal transition duration (${transitionDuration})`;
                result.className = 'result pass';
            }
        }

        function testHoverEffects() {
            const button = document.querySelector('.calc-button');
            const result = document.getElementById('result-hover');
            
            if (!button) {
                result.textContent = '‚ùå No button found';
                result.className = 'result fail';
                return;
            }

            // Simulate hover
            button.classList.add('hover-test');
            const style = document.createElement('style');
            style.textContent = '.calc-button.hover-test { /* hover simulation */ }';
            document.head.appendChild(style);
            
            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches || 
                                 document.getElementById('reduced-motion-sim');
            
            if (reducedMotion) {
                result.textContent = '‚úÖ PASS: Hover transforms should be disabled in reduced motion';
                result.className = 'result pass';
            } else {
                result.textContent = '‚úÖ PASS: Hover effects enabled (normal mode)';
                result.className = 'result pass';
            }
            
            button.classList.remove('hover-test');
            style.remove();
        }

        function testFunctionality() {
            const result = document.getElementById('result-functionality');
            
            // Test if calculator is interactive
            const buttons = document.querySelectorAll('.calc-button');
            const display = document.querySelector('.main-display');
            
            if (buttons.length > 0 && display) {
                result.textContent = '‚úÖ PASS: Calculator is fully functional';
                result.className = 'result pass';
            } else {
                result.textContent = '‚ùå FAIL: Calculator elements not found';
                result.className = 'result fail';
            }
        }

        // Run all tests on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testEntranceAnimation();
                testButtonStagger();
                testGradientAnimation();
                testTransitionDuration();
                testHoverEffects();
                testFunctionality();
            }, 1000);
        });
    </script>
</body>
</html>
